<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	  lang="ko">
<head>
<title th:text="${@site.title}"></title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link th:href="@{/assets/css/board.css}" rel="stylesheet" type="text/css">
</head>
<body>
	<div id="container">
		<th:block th:include="th/includes/header"></th:block>
		<div id="content">
			<div id="board">
				<!-- 검색 -->
				<form id="search_form" th:action="@{/board}" method="get">
					<input type="text" id="kwd" name="kwd" value="">
					<input type="submit" value="찾기">
				</form>
				
				<!-- 게시판 목록 -->
				<table class="tbl-ex">
					<tr>
						<th>번호</th>
						<th>제목</th>
						<th>글쓴이</th>
						<th>조회수</th>
						<th>작성일</th>
						<th>&nbsp;</th>
					</tr>
					
					<tr th:each="vo, status: ${map.list}">
							<!-- 번호 -->
							<td>[[${map.totalCount - (map.currentPage - 1) * map.listSize - status.index}]]</td>
							
							<!-- 제목 -->
		                    <td th:if="${vo.depth > 0}" class="left" th:style="|text-align:left; padding-left:${20*vo.depth}px|">
								<img th:src="@{/assets/images/reply.png}">
								<a th:href="@{(|/board/view/${vo.no}|)(p=${map.currentPage}, kwd=${map.keyword})}">[[${vo.title}]]</a>
							</td>
		                    <td th:unless="${vo.depth > 0}" class="left" style="text-align:left">
								<a th:href="@{(|/board/view/${vo.no}|)(p=${map.currentPage}, kwd=${map.keyword})}">[[${vo.title}]]</a>
							</td>
					        
							<!-- 글쓴이, 조회수, 작성일 -->
		                    <td th:text="${vo.writer}"></td>
		                    <td th:text="${vo.hit}"></td>
		                    <td th:text="${vo.regDate}"></td>
							
							 <!-- 삭제 버튼 (로그인 + 작성자 본인만) -->
							<td>
							    <th:block sec:authorize="isAuthenticated()">
							        <a th:if="${#authentication.principal != null and #authentication.principal.id == vo.userId}"
							           th:href="@{/board/delete/{no}(no=${vo.no}, p=${map.currentPage}, kwd=${map.keyword})}"
							           th:style="|background-image:url(@{/assets/images/recycle.png})|"
							           class="del">
							            삭제
							        </a>
							    </th:block>
							</td>
						</tr>
				</table>
				
				<!-- 페이지네이션 -->
				<div class="pager">
					<ul>
						<li th:if="${map.prevPage > 0}">
                        	<a th:href="@{/board(p=${map.prevPage}, kwd=${map.keyword})}">◀</a>
                    	</li>
						
						<!-- 페이지 번호 반복 -->
						<th:block th:each="page: ${#numbers.sequence(map.beginPage, map.beginPage + map.listSize - 1)}">
							<li th:if="${map.endPage < page}" th:text="${page}"></li>
							<li th:if="${map.currentPage == page}" th:text="${page}" class="selected"></li>
							<li th:if="${map.endPage >= page && map.currentPage != page}">
								<a th:href="@{/board(p=${page}, kwd=${map.keyword})}" th:text="${page}"></a>
							</li>
						</th:block>
						
						<!-- 다음 페이지 -->
                    	<li th:if="${map.nextPage > 0}">
							<a th:href="@{/board(p=${map.nextPage}, kwd=${map.keyword})}">▶</a>
						</li>	
					</ul>
				</div>			
				
				<!-- 글쓰기 버튼 -->
            	<div class="bottom">
					<a sec:authorize="isAuthenticated()" th:href="@{/board/write(p=${map.currentPage}, kwd=${map.keyword})}" id="new-book">글쓰기</a>
				</div>
			</div>
		</div>
		
		<th:block th:include="th/includes/navigation"></th:block>
		<th:block th:include="th/includes/footer"></th:block>
	</div>
</body>
</html>